# poly_maker_autorun 检查问题清单

以下问题基于《poly_maker_autorun 改造需求与实施方案》与仓库现有代码对照核查的结果，列出了当前实现的偏差与改进思路。

## 1. 全局配置解析不匹配
- **问题**：`poly_maker_autorun.py` 仅解析平铺的配置键（如 `topics_poll_sec`、`max_concurrent_tasks`），而示例配置 `POLYMARKET_MAKER/config/global_config.json` 使用 `scheduler`/`paths` 嵌套结构，导致并发度、轮询间隔、日志/数据目录等自定义值被忽略，运行只能回退到默认值，违背“参数预置、运行时无需手动输入”的需求。
- **思路**：统一配置格式。可以扩展 `GlobalConfig.from_dict` 支持嵌套结构并写入日志、数据路径，也可反向调整配置模板与文档保持键名一致。

## 2. 话题写盘时机过早
- **问题**：`_refresh_topics` 一旦发现新话题即写入 `handled_topics`，而子进程启动 `_start_topic_process` 发生在后续调度阶段；若进程启动失败，该话题仍被标记为已处理，后续不会再尝试。
- **思路**：仅在子进程成功启动（`Popen` 返回且存活）后再写入已处理列表，或在失败时回滚/重新入队。

## 3. 子进程异常缺少重试
- **问题**：`_poll_tasks` 将异常退出标记为 `error` 或 `exited` 后不会重新调度，也未结合 `process_start_retries` 做再次拉起，与“异常可捕获、可选择重试”目标不符。
- **思路**：在检测到异常退出时依据配置重试启动并记录重试次数，或提供开关选择自动重试/仅告警。

## 4. 运行状态持久化未恢复
- **问题**：`runtime_status_path` 仅写入队列与任务快照，程序重启不会读取或恢复这些信息，也未处理遗留进程/日志；若期望“状态监控与重启可续跑”，当前实现不足。
- **思路**：启动时读取上次状态并与系统进程对齐，或在文档中明确不支持冷启动恢复。

## 5. 主循环健壮性不足
- **问题**：主循环异常捕获范围有限；若 `_start_topic_process` 等内部步骤抛出未捕获异常，`run_loop` 可能提前终止，仅在 `finally` 清理任务且缺少异常日志与补偿，无法满足“不中断”要求。
- **思路**：在主循环外层增加统一异常处理与告警输出，并对启动/调度逻辑添加防御性 `try/except` 与可选重试。
